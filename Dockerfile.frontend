FROM node:18-alpine AS build
WORKDIR /app

# 只拷贝根依赖文件，利用缓存
COPY package*.json ./
RUN npm ci

# 拷贝全部代码（若有后端目录，构建阶段会被忽略）
COPY . .

# 构建前端产物（假设 npm run build 输出到 dist）
RUN npm run build

# 运行时镜像
FROM nginx:1.25-alpine

# 可选：使用自定义 nginx 配置反代后端（需要时再启用）
# COPY nginx.conf /etc/nginx/conf.d/default.conf

COPY --from=build /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]

