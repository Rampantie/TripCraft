FROM node:18-alpine

# 以构建参数接收百炼密钥，并写入运行时环境变量
ARG BAILIAN_API_KEY
ENV BAILIAN_API_KEY=$BAILIAN_API_KEY

# 切换到后端目录作为工作目录
WORKDIR /app/backend

# 仅拷贝后端依赖清单并安装生产依赖
COPY backend/package*.json ./
RUN npm ci --omit=dev

# 拷贝后端源代码
COPY backend ./

ENV PORT=3001
EXPOSE 3001

# 直接从后端目录启动
CMD ["node", "server.js"]

